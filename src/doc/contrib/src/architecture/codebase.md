# Codebase Overview

This is a very high-level overview of the Payload codebase.

* [`src/bin/payload`](https://github.com/dustlang/payload/tree/master/src/bin/payload)
  — Payload is split in a library and a binary. This is the binary side that
  handles argument parsing, and then calls into the library to perform the
  appropriate subcommand. Each Payload subcommand is a separate module here. See
  [SubCommands](subcommands.md).

* [`src/payload/ops`](https://github.com/dustlang/payload/tree/master/src/payload/ops)
  — Every major operation is implemented here. This is where the binary CLI
  usually calls into to perform the appropriate action.

    * [`src/payload/ops/payload_compile.rs`](https://github.com/dustlang/payload/blob/master/src/payload/ops/payload_compile.rs)
      — This is the entry point for all the compilation commands. This is a
      good place to start if you want to follow how compilation starts and
      flows to completion.

* [`src/payload/core/resolver`](https://github.com/dustlang/payload/tree/master/src/payload/core/resolver)
  — This is the dependency and feature resolvers.

* [`src/payload/core/compiler`](https://github.com/dustlang/payload/tree/master/src/payload/core/compiler)
  — This is the code responsible for running `rustc` and `rustdoc`.

    * [`src/payload/core/compiler/build_context/mod.rs`](https://github.com/dustlang/payload/blob/master/src/payload/core/compiler/build_context/mod.rs)
      — The `BuildContext` is the result of the "front end" of the build
      process. This contains the graph of work to perform and any settings
      necessary for `rustc`. After this is built, the next stage of building
      is handled in `Context`.

    * [`src/payload/core/compiler/context`](https://github.com/dustlang/payload/blob/master/src/payload/core/compiler/context/mod.rs)
      — The `Context` is the mutable state used during the build process. This
      is the core of the build process, and everything is coordinated through
      this.

    * [`src/payload/core/compiler/fingerprint.rs`](https://github.com/dustlang/payload/blob/master/src/payload/core/compiler/fingerprint.rs)
      — The `fingerprint` module contains all the code that handles detecting
      if a crate needs to be recompiled.

* [`src/payload/core/source`](https://github.com/dustlang/payload/tree/master/src/payload/core/source)
  — The `Source` trait is an abstraction over different sources of packages.
  Sources are uniquely identified by a `SourceId`. Sources are implemented in
  the
  [`src/payload/sources`](https://github.com/dustlang/payload/tree/master/src/payload/sources)
  directory.

* [`src/payload/util`](https://github.com/dustlang/payload/tree/master/src/payload/util)
  — This directory contains generally-useful utility modules.

* [`src/payload/util/config`](https://github.com/dustlang/payload/tree/master/src/payload/util/config)
  — This directory contains the config parser. It makes heavy use of
  [serde](https://serde.rs/) to merge and translate config values. The
  `Config` is usually accessed from the
  [`Workspace`](https://github.com/dustlang/payload/blob/master/src/payload/core/workspace.rs),
  though references to it are scattered around for more convenient access.

* [`src/payload/util/toml`](https://github.com/dustlang/payload/tree/master/src/payload/util/toml)
  — This directory contains the code for parsing `Payload.toml` files.

    * [`src/payload/ops/lockfile.rs`](https://github.com/dustlang/payload/blob/master/src/payload/ops/lockfile.rs)
      — This is where `Payload.lock` files are loaded and saved.

* [`src/doc`](https://github.com/dustlang/payload/tree/master/src/doc)
  — This directory contains Payload's documentation and man pages.

* [`src/etc`](https://github.com/dustlang/payload/tree/master/src/etc)
  — These are files that get distributed in the `etc` directory in the Rust release.
  The man pages are auto-generated by a script in the `src/doc` directory.

* [`crates`](https://github.com/dustlang/payload/tree/master/crates)
  — A collection of independent crates used by Payload.
